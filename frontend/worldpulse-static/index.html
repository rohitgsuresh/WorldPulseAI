<!doctype html>
<html lang="en" style="background:#0a0a0a;color:#fff;font-family:system-ui, sans-serif;">
  <head>
    <meta charset="utf-8" />
    <title>WorldPulse üåç | Global Sentiment Intelligence</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
      :root{
        --c-bg:#000;
        --c-cyan:#00FFFF;
        --c-green:#39FF14;
        --c-red:#FF3131;
        --c-yellow:#FFFF00;
        --c-orange:#FFA500;
        --c-border:rgba(255,255,255,.15);

        /* layout knobs */
        --panel-w: 460px;           /* sidebar width */
        --legend-font: 13px;
        --legend-pad: 16px;
      }

      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        background:radial-gradient(circle at 10% 10%, #1a1a2e 0%, var(--c-bg) 80%);
        color:#fff;
        font-family:'Space Mono', monospace;
      }

      /* ---------- INTRO OVERLAY (BIGGER + CINEMATIC) ---------- */
      .intro-overlay {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        background:
          radial-gradient(1600px 900px at 10% 15%, rgba(0,255,255,0.1), transparent 60%),
          radial-gradient(1400px 1000px at 90% 85%, rgba(57,255,20,0.08), transparent 60%),
          #000;
        z-index: 9999;
        transition: opacity .7s ease;
      }
      .intro-overlay.hide { opacity: 0; pointer-events: none; }

      .intro-card {
        width: min(950px, 96vw);
        border: 2px solid rgba(0,255,255,0.3);
        border-radius: 24px;
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(18px) saturate(160%);
        padding: 48px 32px;
        box-shadow: 0 0 60px rgba(0,255,255,0.25);
        text-align: center;
        transform: scale(1.05);
        animation: intro-pop 1.5s ease-out forwards;
      }
      @keyframes intro-pop {
        0% { transform: scale(0.9); opacity: 0; }
        100% { transform: scale(1.05); opacity: 1; }
      }
      .intro-logo {
        font-size: clamp(42px, 6vw, 64px);
        font-weight: 800;
        letter-spacing: .15em;
        color: var(--c-cyan);
        text-shadow: 0 0 28px rgba(0,255,255,0.9), 0 0 60px rgba(0,255,255,0.5);
        margin-bottom: 16px;
        animation: pulse 2s ease-in-out infinite;
      }
      .intro-sub {
        font-size: clamp(14px, 2.2vw, 18px);
        color: rgba(255,255,255,0.85);
        margin-bottom: 32px;
        letter-spacing: .1em;
      }
      .intro-hero {
        height: 300px; /* bigger Earth display */
        border-radius: 20px;
        border: 1px dashed rgba(255,255,255,0.15);
        margin: 20px auto 32px;
        display: grid;
        place-items: center;
        background:
          radial-gradient(800px 500px at 50% 30%, rgba(0,255,255,0.1), transparent 60%),
          radial-gradient(700px 500px at 50% 80%, rgba(57,255,20,0.08), transparent 60%);
        overflow: hidden;
      }
      .earth-ring {
        width: 260px; height: 260px;
        border-radius: 50%;
        border: 3px solid rgba(0,255,255,0.5);
        box-shadow: 0 0 30px rgba(0,255,255,0.35) inset, 0 0 50px rgba(0,255,255,0.25);
        animation: spin 24s linear infinite;
        position: relative;
      }
      .earth-ring::after {
        content: "";
        position: absolute; inset: 10%;
        border-radius: 50%;
        border: 3px solid rgba(57,255,20,0.5);
        box-shadow: 0 0 28px rgba(57,255,20,0.35) inset;
        animation: spin 18s linear reverse infinite;
      }
      .intro-actions {
        display: flex; gap: 16px; justify-content: center; align-items: center; margin-top: 8px;
      }
      .btn {
        background: var(--c-green);
        color: #000;
        border: none;
        border-radius: 14px;
        padding: 14px 24px;
        font-size: 16px;
        font-weight: 800;
        cursor: pointer;
        box-shadow: 0 0 24px rgba(57,255,20,0.7);
        transition: transform .15s ease, background .2s ease;
      }
      .btn:hover { transform: translateY(-2px); background: #6cff64; }
      .btn[disabled] { opacity: .6; cursor: not-allowed; transform: none; }
      .intro-skip {
        display: inline-flex; align-items: center; gap: 8px;
        font-size: 13px; color: rgba(255,255,255,0.8); cursor: pointer; user-select: none;
      }
      .intro-skip input { accent-color: #2cff2c; }
      @keyframes pulse { 0%,100%{text-shadow:0 0 12px rgba(0,255,255,.6)} 50%{text-shadow:0 0 26px rgba(0,255,255,.95)} }
      @keyframes spin { 0%{transform:rotate(0)}100%{transform:rotate(360deg)} }

      /* ---------- PAGE LAYOUT ---------- */
      .page{
        min-height:100vh;
        display:grid;
        grid-template-rows:auto auto 1fr;
      }

      header{
        padding:16px 24px;
        border-bottom:2px solid var(--c-cyan);
        box-shadow:0 0 10px rgba(0,255,255,.3);
        background:rgba(0,0,0,.6);
        backdrop-filter:blur(12px);
        display:flex;flex-wrap:wrap;align-items:baseline;gap:12px;z-index:10;
      }
      header .title{font-size:16px;font-weight:700;color:var(--c-cyan);text-shadow:0 0 8px rgba(0,255,255,.7);letter-spacing:.05em}
      header .subtitle{font-size:11px;color:rgba(255,255,255,.6);letter-spacing:.1em}

      .searchbar{
        display:grid;
        grid-template-columns:1fr auto;
        gap:12px;
        align-items:center;
        padding:16px 24px;
        border-bottom:1px solid var(--c-border);
        background:rgba(0,0,0,.8);
        z-index:5;
      }
      .searchrow{display:grid;grid-template-columns:1fr auto auto auto;gap:10px;align-items:center}
      .countryrow{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
      .searchbar input{
        background:var(--c-bg);
        border:1px solid var(--c-cyan);
        border-radius:6px;color:var(--c-green);
        padding:10px 12px;font-size:14px;outline:none;
        box-shadow:0 0 8px rgba(0,255,255,.3);transition:.2s;
      }
      .searchbar input:focus{border-color:var(--c-green);box-shadow:0 0 10px var(--c-green)}
      .searchbar button{
        background:var(--c-green);border:none;border-radius:6px;color:#000;
        font-size:14px;font-weight:700;padding:10px 16px;cursor:pointer;
        box-shadow:0 0 10px rgba(57,255,20,.8);transition:background .2s, transform .1s;white-space:nowrap;
      }
      .searchbar button:hover{background:#6cff64;transform:translateY(-1px)}

      /* Main grid: globe | fixed sidebar */
      #app{
        display:grid;
        grid-template-columns: 1fr minmax(var(--panel-w), var(--panel-w));
        min-height:0;
      }

      .globe-area{
        position:relative;
        min-height:60vh;
        overflow:hidden;
      }
      /* Make the three-globe canvas fill perfectly */
      .globe-area canvas{
        position:absolute !important;
        inset:0 !important;
        width:100% !important;
        height:100% !important;
        max-width:none !important;
      }

      .sidepanel{
        flex:0 0 var(--panel-w);
        width:var(--panel-w);
        max-width:var(--panel-w);
        background:rgba(0,0,0,.82);
        border-left:1px solid var(--c-cyan);
        box-shadow:-4px 0 15px rgba(0,255,255,.1);
        padding:24px;
        display:flex;flex-direction:column;
        overflow:hidden;
      }
      .sidepanel-scroll{overflow:auto;padding-right:6px;min-height:0;flex:1}
      .sidepanel h2{
        font-size:16px;font-weight:700;color:var(--c-green);
        text-shadow:0 0 5px rgba(57,255,20,.5);
        display:flex;justify-content:space-between;align-items:baseline;
        border-bottom:1px dashed rgba(255,255,255,.12);padding-bottom:8px;margin-bottom:12px;
      }
      .score{font-size:12px;color:var(--c-cyan)}
      .summary{font-size:13px;line-height:1.5;color:rgba(255,255,255,.92);white-space:pre-line}
      .keywords{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
      .chip{background:rgba(0,255,255,.1);border:1px solid var(--c-cyan);color:var(--c-cyan);font-size:10px;padding:4px 8px;border-radius:4px;box-shadow:0 0 5px rgba(0,255,255,.5)}

      /* ---------- FIBO VISUAL PANEL ---------- */
      .fibo-panel{
        margin-top:16px;
        padding-top:10px;
        border-top:1px dashed rgba(255,255,255,.18);
      }
      .fibo-panel.hidden{display:none}
      .fibo-title{
        font-size:11px;
        color:var(--c-cyan);
        letter-spacing:.08em;
        text-transform:uppercase;
        margin-bottom:6px;
      }
      .fibo-status{
        font-size:11px;
        color:rgba(255,255,255,.7);
        margin-bottom:6px;
      }
      .fibo-image{
        width:100%;
        border-radius:10px;
        border:1px solid rgba(255,255,255,.18);
        display:none; /* shown when loaded */
        box-shadow:0 0 14px rgba(0,0,0,.7);
      }
      .fibo-caption{
        font-size:11px;
        color:rgba(255,255,255,.7);
        margin-top:6px;
      }

      .sidepanel-footer{
        position:sticky;bottom:0;
        background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.9) 18%, rgba(0,0,0,.95) 100%);
        border-top:1px dashed rgba(255,255,255,.12);
        padding-top:10px;padding-bottom:8px;margin-top:12px;
      }
      .footer-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px 12px;align-items:start}
      .footer-col h3{margin:6px 0 8px;font-size:11px;color:var(--c-cyan);letter-spacing:.06em}
      .token-list{display:flex;flex-wrap:wrap;gap:8px;max-height:120px;overflow:auto}
      .token{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.18);border-radius:6px;padding:5px 8px;font-size:11px;cursor:pointer;white-space:nowrap}
      .token:hover{background:rgba(255,255,255,.12)}
      .token .x{margin-left:8px;opacity:.6;font-weight:700}

      /* Legend (bigger / clearer) */
      .legend{
        position:absolute;left:24px;bottom:24px;
        background:rgba(0,0,0,.72);
        border:1px solid var(--c-cyan);
        border-radius:10px;
        font-size:var(--legend-font);
        line-height:1.5;
        color:rgba(255,255,255,.95);
        padding:var(--legend-pad);
        backdrop-filter:blur(10px);
        box-shadow:0 0 12px rgba(0,255,255,.5);
        z-index:2;
      }
      .legend-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
      .legend-color{width:16px;height:16px;border-radius:3px;border:1px solid rgba(255,255,255,.25)}
      .legend-row:last-child{margin-bottom:0}

      @media (max-width: 980px){
        :root{ --panel-w: 100vw; }
        #app{ display:block; }
        .sidepanel{ width:100%; max-width:100%; border-left:none; border-top:1px solid var(--c-cyan); }
        .globe-area{ min-height:50vh; }
        .legend{ right:24px; left:auto; }
      }
    </style>
  </head>

  <body>
    <!-- INTRO OVERLAY -->
    <div id="introOverlay" class="intro-overlay" aria-live="polite">
      <div class="intro-card">
        <div class="intro-logo">WORLD PULSE</div>
        <div class="intro-sub">GLOBAL SENTIMENT INTELLIGENCE ‚Ä¢ INITIALIZING SYSTEMS</div>
        <div class="intro-hero">
          <div class="earth-ring" aria-hidden="true"></div>
        </div>
        <div class="intro-actions">
          <button id="enterBtn" class="btn" disabled>Loading‚Ä¶</button>
          <label class="intro-skip" title="Don‚Äôt show this intro again (this tab)">
            <input type="checkbox" id="skipIntro" />
            Skip next time
          </label>
        </div>
      </div>
    </div>

    <div class="page">
      <!-- HEADER -->
      <header>
        <div class="title">WORLD PULSE</div>
        <div class="subtitle">GLOBAL SENTIMENT INTELLIGENCE / SYSTEM ONLINE</div>
      </header>

      <!-- SEARCH -->
      <div class="searchbar">
        <div class="searchrow">
          <input id="topicInput" placeholder="Try: air pollution, water crisis, food insecurity" value="" />
          <button id="analyzeBtn" title="Analyze topic">Analyze</button>
          <button id="bookmarkBtn" title="Bookmark topic">‚òÜ</button>
          <button id="clearBtn" title="Clear topic & reset globe">Clear</button>
        </div>
        <div class="countryrow">
          <input id="countryInput" list="countryList" placeholder="Jump to country (e.g., India, USA)" />
          <button id="goCountryBtn" title="Go to country">Go</button>
          <datalist id="countryList"></datalist>
        </div>
      </div>

      <!-- MAIN -->
      <div id="app">
        <div class="globe-area">
          <div id="globeMount" style="width:100%;height:100%;background:rgba(255,255,255,0.03)"></div>

          <div class="legend">
            <div style="margin-bottom:8px;font-weight:700">// Sentiment Status (Score)</div>
            <div class="legend-row">
              <div class="legend-color" style="background:var(--c-green);box-shadow:0 0 5px var(--c-green)"></div>
              <div>‚â• 0.5: Stable / Improving</div>
            </div>
            <div class="legend-row">
              <div class="legend-color" style="background:var(--c-yellow);box-shadow:0 0 5px var(--c-yellow)"></div>
              <div>0.0 to &lt; 0.5: Mixed / Watch</div>
            </div>
            <div class="legend-row">
              <div class="legend-color" style="background:var(--c-orange);box-shadow:0 0 5px var(--c-orange)"></div>
              <div>-0.5 to &lt; 0.0: High Concern / Stress</div>
            </div>
            <div class="legend-row">
              <div class="legend-color" style="background:var(--c-red);box-shadow:0 0 5px var(--c-red)"></div>
              <div>&lt; -0.5: Crisis / Severe Stress</div>
            </div>
          </div>
        </div>

        <aside class="sidepanel">
          <div class="sidepanel-scroll">
            <h2>
              <span id="countryName">-- NO COUNTRY SELECTED --</span>
              <span class="score" id="countryScore"></span>
            </h2>

            <div style="font-size:11px;color:var(--c-cyan);margin-bottom:12px;">[ DATA SUMMARY ]</div>
            <div class="summary" id="countrySummary">Click a country on the globe to inspect its mood on this topic.</div>

            <!-- FIBO visual snapshot -->
            <div id="fiboPanel" class="fibo-panel hidden">
              <div class="fibo-title">[ VISUAL SNAPSHOT ]</div>
              <div class="fibo-status" id="fiboStatus"></div>
              <img id="fiboImage" class="fibo-image" alt="AI visual snapshot" />
              <div class="fibo-caption" id="fiboCaption"></div>
            </div>

            <div style="font-size:11px;color:var(--c-cyan);margin-top:20px;">[ KEYWORD CLOUD ]</div>
            <div class="keywords" id="countryKeywords"></div>
          </div>

          <div class="sidepanel-footer">
            <div class="footer-grid">
              <div class="footer-col">
                <h3>Recent Topics</h3>
                <div id="historyList" class="token-list"></div>
              </div>
              <div class="footer-col">
                <h3>Bookmarks</h3>
                <div id="bookmarkList" class="token-list"></div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- Small inline script to run the intro overlay without touching app.js -->
    <script>
      (function(){
        const intro = document.getElementById('introOverlay');
        const enterBtn = document.getElementById('enterBtn');
        const skip = document.getElementById('skipIntro');

        try {
          if (sessionStorage.getItem('wp_skip_intro') === '1') {
            intro.classList.add('hide');
          } else {
            // Simulate asset loading: enable "Enter World" shortly after DOM is ready
            setTimeout(() => { enterBtn.disabled = false; enterBtn.textContent = 'Enter World'; }, 900);
          }

          enterBtn.addEventListener('click', () => {
            if (skip.checked) {
              sessionStorage.setItem('wp_skip_intro', '1');
            }
            intro.classList.add('hide');
          });
        } catch (e) {
          // If storage fails (private mode), still allow continue
          setTimeout(() => { enterBtn.disabled = false; enterBtn.textContent = 'Enter World'; }, 900);
          enterBtn.addEventListener('click', () => intro.classList.add('hide'));
        }
      })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/globe.gl@2.26.4/dist/globe.gl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/topojson@3"></script>
    <script src="app.js?v=11"></script>
  </body>
</html>
